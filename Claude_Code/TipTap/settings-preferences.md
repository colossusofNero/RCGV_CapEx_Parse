# Settings for Payment Methods and Preferences

## Main Settings Screen
```
┌─────────────────────────────────────┐
│ [Back]        Settings              │
│                                     │
│          👤 Sarah Johnson          │
│        sarah.johnson@email.com      │
│                                     │
│  ┌─────────────────────────────────┐│
│  │ 💳 Payment Methods              ││
│  └─────────────────────────────────┘│
│                                     │
│  ┌─────────────────────────────────┐│
│  │ ⚙️  Preferences                 ││
│  └─────────────────────────────────┘│
│                                     │
│  ┌─────────────────────────────────┐│
│  │ 🔔 Notifications                ││
│  └─────────────────────────────────┘│
│                                     │
│  ┌─────────────────────────────────┐│
│  │ 🔒 Security & Privacy           ││
│  └─────────────────────────────────┘│
│                                     │
│  ┌─────────────────────────────────┐│
│  │ 📊 Transaction History          ││
│  └─────────────────────────────────┘│
│                                     │
│  ┌─────────────────────────────────┐│
│  │ ❓ Help & Support               ││
│  └─────────────────────────────────┘│
└─────────────────────────────────────┘
```

## Payment Methods Screen
```
┌─────────────────────────────────────┐
│ [Back]    Payment Methods           │
│                                     │
│           Primary Method            │
│                                     │
│  ┌─ ✓ [💳] Chase Checking      ────┐│
│  │     •••• •••• •••• 1234          ││
│  │     Available: $2,847.50         ││
│  │                           [Edit] ││
│  └─────────────────────────────────┘│
│                                     │
│          Other Methods              │
│                                     │
│  ┌─ ○ [💳] Wells Fargo Savings ───┐│
│  │     •••• •••• •••• 5678          ││
│  │     Available: $1,250.00         ││
│  │                           [Edit] ││
│  └─────────────────────────────────┘│
│                                     │
│  ┌─ ○ [💳] Capital One Credit ────┐│
│  │     •••• •••• •••• 9876          ││
│  │     Limit: $5,000                ││
│  │                           [Edit] ││
│  └─────────────────────────────────┘│
│                                     │
│         [Add Payment Method]        │
│                                     │
│        [Set Spending Limits]        │
└─────────────────────────────────────┘
```

## Add Payment Method
```
┌─────────────────────────────────────┐
│ [Back]   Add Payment Method         │
│                                     │
│         Choose Account Type         │
│                                     │
│  ┌─────────────────────────────────┐│
│  │    🏦 Bank Account              ││
│  │    Link checking or savings     ││
│  └─────────────────────────────────┘│
│                                     │
│  ┌─────────────────────────────────┐│
│  │    💳 Credit Card               ││
│  │    Add Visa, Mastercard, etc.   ││
│  └─────────────────────────────────┘│
│                                     │
│  ┌─────────────────────────────────┐│
│  │    💰 Digital Wallet            ││
│  │    PayPal, Apple Pay, etc.      ││
│  └─────────────────────────────────┘│
│                                     │
│  ┌─────────────────────────────────┐│
│  │    🪙 Cryptocurrency            ││
│  │    Bitcoin, Ethereum, etc.      ││
│  └─────────────────────────────────┘│
│                                     │
│                                     │
│            [Cancel]                 │
└─────────────────────────────────────┘
```

## Preferences Screen
```
┌─────────────────────────────────────┐
│ [Back]      Preferences             │
│                                     │
│           Default Amounts           │
│                                     │
│  Quick Amount Presets               │
│  ┌─ $5  ─┐ ┌─ $10 ─┐ ┌─ $20 ─┐      │
│  │  [✓] ││ │  [✓] ││ │  [✓] ││      │
│  └──────┘ └──────┘ └──────┘      │
│  ┌─ $25 ─┐ ┌─ $50 ─┐ ┌─ Custom─┐    │
│  │  [✓] ││ │  [✓] ││ │   [ ] ││      │
│  └──────┘ └──────┘ └─────────┘    │
│                                     │
│           Default Category          │
│  ┌─ Auto-detect (Recommended)   [✓]─┐│
│  │  🤖 Smart categorization        ││
│  └─────────────────────────────────┘│
│                                     │
│           Transfer Method           │
│  ┌─ NFC Tap (Recommended)       [✓]─┐│
│  │  📱 Touch phones together       ││
│  └─────────────────────────────────┘│
│  ┌─ QR Code                     [ ]─┐│
│  │  📷 Scan or show QR codes       ││
│  └─────────────────────────────────┘│
│                                     │
│            [Save Changes]           │
└─────────────────────────────────────┘
```

## Notification Settings
```
┌─────────────────────────────────────┐
│ [Back]      Notifications           │
│                                     │
│          Transaction Alerts         │
│                                     │
│  ┌─ Tips Sent              [✓] ────┐│
│  │  Get notified when tips are sent││
│  └─────────────────────────────────┘│
│                                     │
│  ┌─ Tips Received          [✓] ────┐│
│  │  Get notified when you receive  ││
│  │  tips from others               ││
│  └─────────────────────────────────┘│
│                                     │
│  ┌─ Payment Confirmations  [✓] ────┐│
│  │  Confirm successful payments    ││
│  └─────────────────────────────────┘│
│                                     │
│          Security Alerts            │
│                                     │
│  ┌─ Login Attempts         [✓] ────┐│
│  │  New device or location logins  ││
│  └─────────────────────────────────┘│
│                                     │
│  ┌─ Account Changes        [✓] ────┐│
│  │  Payment methods, passwords     ││
│  └─────────────────────────────────┘│
│                                     │
│        [Test Notifications]         │
└─────────────────────────────────────┘
```

## Security & Privacy Screen
```
┌─────────────────────────────────────┐
│ [Back]    Security & Privacy        │
│                                     │
│             Login Security          │
│                                     │
│  ┌─────────────────────────────────┐│
│  │ 🔐 Change Password              ││
│  │    Last changed: 2 months ago   ││
│  └─────────────────────────────────┘│
│                                     │
│  ┌─ Two-Factor Auth        [✓] ────┐│
│  │  📱 SMS + App authentication    ││
│  │                         [Setup] ││
│  └─────────────────────────────────┘│
│                                     │
│  ┌─ Biometric Login        [✓] ────┐│
│  │  👆 Fingerprint + Face ID       ││
│  └─────────────────────────────────┘│
│                                     │
│              Privacy                │
│                                     │
│  ┌─ Anonymous Tips         [ ] ────┐│
│  │  Hide your name when sending    ││
│  └─────────────────────────────────┘│
│                                     │
│  ┌─ Usage Analytics        [✓] ────┐│
│  │  Help improve the app           ││
│  └─────────────────────────────────┘│
│                                     │
│         [Manage Data]               │
└─────────────────────────────────────┘
```

## Spending Limits Screen
```
┌─────────────────────────────────────┐
│ [Back]     Spending Limits          │
│                                     │
│            Daily Limits             │
│                                     │
│  Per Transaction                    │
│  ┌─────────────────────────────────┐│
│  │ Maximum: $ 500     [Edit]       ││
│  └─────────────────────────────────┘│
│                                     │
│  Daily Total                        │
│  ┌─────────────────────────────────┐│
│  │ Maximum: $ 1,000   [Edit]       ││
│  └─────────────────────────────────┘│
│                                     │
│           Weekly Limits             │
│                                     │
│  ┌─────────────────────────────────┐│
│  │ Maximum: $ 2,500   [Edit]       ││
│  └─────────────────────────────────┘│
│                                     │
│           Monthly Limits            │
│                                     │
│  ┌─────────────────────────────────┐│
│  │ Maximum: $ 8,000   [Edit]       ││
│  └─────────────────────────────────┘│
│                                     │
│  ┌─ Alert When Near Limit  [✓] ────┐│
│  │  Get warnings at 80% of limit   ││
│  └─────────────────────────────────┘│
└─────────────────────────────────────┘
```

## Profile Settings
```
┌─────────────────────────────────────┐
│ [Back]        Profile               │
│                                     │
│         ┌─────────────┐             │
│         │   [Photo]   │             │
│         │     👤      │             │
│         └─────────────┘             │
│                                     │
│  Display Name                       │
│  ┌─────────────────────────────────┐│
│  │ Sarah Johnson                   ││
│  └─────────────────────────────────┘│
│                                     │
│  Username                           │
│  ┌─────────────────────────────────┐│
│  │ @sarahj                         ││
│  └─────────────────────────────────┘│
│                                     │
│  Email Address                      │
│  ┌─────────────────────────────────┐│
│  │ sarah.johnson@email.com         ││
│  └─────────────────────────────────┘│
│                                     │
│  Phone Number                       │
│  ┌─────────────────────────────────┐│
│  │ (555) 123-4567                  ││
│  └─────────────────────────────────┘│
│                                     │
│            [Save Changes]           │
│                                     │
│           [Delete Account]          │
└─────────────────────────────────────┘
```

## Design Specifications

### Settings List Items
```css
.settings-item {
  display: flex;
  align-items: center;
  padding: 16px;
  background: white;
  border-radius: 12px;
  margin: 8px 16px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.06);
  transition: all 0.2s ease;
}

.settings-item:active {
  transform: scale(0.98);
  background: #f8f9fa;
}

.settings-icon {
  width: 24px;
  height: 24px;
  margin-right: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.settings-content {
  flex: 1;
  display: flex;
  flex-direction: column;
}

.settings-title {
  font-size: 16px;
  font-weight: 600;
  color: neutral-900;
  margin-bottom: 2px;
}

.settings-subtitle {
  font-size: 14px;
  color: neutral-700;
}
```

### Payment Method Cards
```css
.payment-method-card {
  background: white;
  border: 2px solid neutral-200;
  border-radius: 16px;
  padding: 16px;
  margin: 8px 16px;
  transition: all 0.2s ease;
}

.payment-method-card.primary {
  border-color: primary-green;
  background: linear-gradient(135deg, #f8fff8, #ffffff);
}

.payment-method-card.primary::before {
  content: "Primary";
  position: absolute;
  top: -8px;
  left: 16px;
  background: primary-green;
  color: white;
  font-size: 12px;
  padding: 4px 8px;
  border-radius: 6px;
}

.card-icon {
  width: 32px;
  height: 20px;
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  margin-right: 12px;
}

.card-details {
  flex: 1;
}

.card-number {
  font-size: 16px;
  font-weight: 600;
  font-family: 'Courier New', monospace;
  margin-bottom: 4px;
}

.card-balance {
  font-size: 14px;
  color: neutral-700;
}
```

### Toggle Switches
```css
.toggle-switch {
  width: 48px;
  height: 28px;
  background: neutral-300;
  border-radius: 14px;
  position: relative;
  cursor: pointer;
  transition: background 0.2s ease;
}

.toggle-switch.active {
  background: primary-green;
}

.toggle-switch::before {
  content: '';
  position: absolute;
  top: 2px;
  left: 2px;
  width: 24px;
  height: 24px;
  background: white;
  border-radius: 50%;
  transition: transform 0.2s ease;
}

.toggle-switch.active::before {
  transform: translateX(20px);
}
```

## User Experience Features

### Smart Defaults
```javascript
const getSmartDefaults = (userProfile) => {
  return {
    quickAmounts: determinePopularAmounts(userProfile.history),
    preferredMethod: userProfile.mostUsedPaymentMethod,
    notifications: {
      tipsReceived: true,
      tipsSent: true,
      security: true,
      marketing: userProfile.optedIn
    },
    spendingLimits: calculateSuggestedLimits(userProfile.income)
  };
};
```

### Contextual Suggestions
```javascript
const getContextualSettings = (location, time, category) => {
  // Suggest different defaults based on context
  if (category === 'golf') {
    return {
      suggestedAmounts: [15, 25, 50],
      preferredMethod: 'primary'
    };
  }

  if (location.type === 'luxury') {
    return {
      suggestedAmounts: [20, 35, 75],
      showHighAmounts: true
    };
  }

  return getStandardSuggestions();
};
```

## Security Features

### Biometric Authentication
```javascript
const BiometricAuth = {
  async isAvailable() {
    return await navigator.credentials.get({
      publicKey: {
        challenge: new Uint8Array(32),
        allowCredentials: [],
        userVerification: 'preferred'
      }
    });
  },

  async register() {
    const credential = await navigator.credentials.create({
      publicKey: {
        challenge: new Uint8Array(32),
        rp: { name: "TipTap" },
        user: {
          id: new Uint8Array(16),
          name: user.email,
          displayName: user.displayName
        },
        pubKeyCredParams: [{ alg: -7, type: "public-key" }]
      }
    });

    return credential;
  }
};
```

### Two-Factor Authentication Setup
```javascript
const TwoFactorAuth = {
  async generateSecret() {
    const secret = await crypto.getRandomValues(new Uint8Array(20));
    return base32.encode(secret);
  },

  generateQRCode(secret, userEmail) {
    const otpauth = `otpauth://totp/TipTap:${userEmail}?secret=${secret}&issuer=TipTap`;
    return QRCode.toDataURL(otpauth);
  },

  async verifyToken(secret, token) {
    const totp = new TOTP(secret);
    return totp.verify(token);
  }
};
```

## Data Management

### Export Data Feature
```javascript
const DataExport = {
  async exportAllData(userId) {
    const data = {
      profile: await getProfile(userId),
      transactions: await getTransactions(userId),
      paymentMethods: await getPaymentMethods(userId, true),
      preferences: await getPreferences(userId),
      exportDate: new Date().toISOString()
    };

    return {
      filename: `tiptap-data-${userId}-${Date.now()}.json`,
      content: JSON.stringify(data, null, 2),
      size: JSON.stringify(data).length
    };
  },

  async deleteUserData(userId, confirmationCode) {
    // Verify deletion code
    if (!verifyDeletionCode(userId, confirmationCode)) {
      throw new Error('Invalid confirmation code');
    }

    // Delete all user data
    await Promise.all([
      deleteProfile(userId),
      deleteTransactions(userId),
      deletePaymentMethods(userId),
      deletePreferences(userId)
    ]);

    return { success: true };
  }
};
```

## Accessibility Implementation

### Screen Reader Support
```html
<div role="group" aria-label="Payment methods">
  <div
    role="radio"
    aria-checked="true"
    aria-label="Chase checking account ending in 1234, primary payment method">
    <!-- Payment method card -->
  </div>
</div>

<div role="group" aria-label="Notification preferences">
  <div role="switch" aria-checked="true" aria-label="Receive tip notifications">
    <!-- Toggle switch -->
  </div>
</div>
```

### High Contrast Mode
```css
@media (prefers-contrast: high) {
  .settings-item {
    border: 2px solid #000;
    background: #fff;
  }

  .toggle-switch {
    border: 2px solid #000;
  }

  .toggle-switch.active {
    background: #000;
    color: #fff;
  }
}
```

### Font Size Scaling
```css
.settings-title {
  font-size: clamp(14px, 4vw, 18px);
}

.settings-subtitle {
  font-size: clamp(12px, 3.5vw, 16px);
}

@media (prefers-reduced-motion: reduce) {
  .settings-item,
  .toggle-switch,
  .payment-method-card {
    transition: none;
  }
}
```

## Error Handling

### Payment Method Errors
```javascript
const PaymentMethodErrors = {
  EXPIRED_CARD: {
    title: "Card Expired",
    message: "Please update your card information",
    action: "Update Card"
  },
  INSUFFICIENT_FUNDS: {
    title: "Insufficient Funds",
    message: "Your account balance is too low",
    action: "Add Funds"
  },
  BANK_CONNECTION_ERROR: {
    title: "Bank Connection Error",
    message: "We couldn't connect to your bank",
    action: "Reconnect"
  }
};
```

### Settings Validation
```javascript
const validateSettings = (settings) => {
  const errors = [];

  if (settings.dailyLimit < settings.transactionLimit) {
    errors.push("Daily limit must be higher than transaction limit");
  }

  if (settings.quickAmounts.length < 3) {
    errors.push("Please select at least 3 quick amounts");
  }

  if (!settings.primaryPaymentMethod) {
    errors.push("Please select a primary payment method");
  }

  return errors;
};
```

## Performance Considerations

### Lazy Loading
```javascript
const SettingsScreen = lazy(() => import('./Settings'));
const PaymentMethods = lazy(() => import('./PaymentMethods'));
const SecuritySettings = lazy(() => import('./SecuritySettings'));

// Load components only when needed
const loadComponent = (componentName) => {
  return React.Suspense(
    { fallback: <SettingsLoadingSkeleton /> },
    React.createElement(componentName)
  );
};
```

### Settings Caching
```javascript
const SettingsCache = {
  cache: new Map(),

  get(userId) {
    return this.cache.get(`settings_${userId}`);
  },

  set(userId, settings) {
    this.cache.set(`settings_${userId}`, {
      data: settings,
      timestamp: Date.now()
    });
  },

  invalidate(userId) {
    this.cache.delete(`settings_${userId}`);
  }
};
```